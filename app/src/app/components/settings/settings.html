<div class="fixed inset-0 z-50 bg-black/70 backdrop-blur-sm">
  <div class="flex min-h-[100dvh] items-start justify-center p-3 sm:p-6">
    <div
      class="flex w-full max-w-6xl flex-col overflow-hidden rounded-xl bg-[#313338] text-gray-100 shadow-2xl md:flex-row md:max-h-[88dvh]"
    >
      <section
        class="w-full shrink-0 bg-[#2B2D31] px-4 py-4 sm:px-6 md:w-72 md:py-10 md:pr-4 md:pl-6"
      >
        <main class="mx-auto w-full max-w-sm md:mx-0">
          <label
            for="user-settings"
            class="text-xs font-bold text-gray-400 uppercase mb-2 block px-2"
            >User Settings</label
          >
          <div class="flex flex-col gap-1">
            <div
              class="flex items-center gap-2 px-2 py-1.5 rounded bg-[#404249] text-white cursor-pointer"
            >
              <lucide-icon [img]="UserPen" class="w-5 h-5" />
              <div class="font-medium">My account</div>
            </div>
            <button
              class="flex items-center cursor-pointer gap-2 px-2 py-1.5 rounded hover:bg-[#35373C] text-gray-400 hover:text-gray-200 w-full text-left transition-colors"
              (click)="onLogout()"
            >
              <lucide-icon [img]="LogOut" class="w-5 h-5" />
              <div class="font-medium">Log out</div>
            </button>
          </div>
        </main>
      </section>

      <main class="flex-1 overflow-y-auto bg-[#313338] p-4 sm:p-6 lg:p-8">
        <nav class="mb-6 flex items-start justify-between gap-4 max-w-3xl">
          <div class="min-w-0 text-lg font-bold text-white sm:text-xl">My account</div>
          <div class="flex flex-col items-center group cursor-pointer shrink-0">
            <a
              routerLink="/"
              class="flex justify-center items-center w-10 h-10 text-gray-400 group-hover:text-white rounded-full transition-colors"
            >
              <lucide-icon [img]="X" class="w-8 h-8" />
            </a>
          </div>
        </nav>

        <form [formGroup]="updateForm" class="max-w-3xl" (ngSubmit)="onSubmit()">
          <div class="relative mb-10 overflow-hidden rounded-t-lg bg-[#202225] p-4 sm:p-5">
            <div class="absolute inset-x-0 top-0 h-24 bg-[#5865F2]"></div>
            <div class="relative pt-12 sm:pt-14">
              <div class="flex items-center gap-3">
                <input
                  id="settings-avatar-upload"
                  type="file"
                  accept="image/*"
                  class="sr-only"
                  (change)="onFileSelected($event)"
                />
                <label
                  for="settings-avatar-upload"
                  class="relative rounded-full bg-[#202225] cursor-pointer select-none focus-within:outline-none focus-within:ring-2 focus-within:ring-[#5865F2] focus-within:ring-offset-2 focus-within:ring-offset-[#202225]"
                  aria-label="Change profile image"
                >
                  @if (!updateForm.value.img) {
                    <app-profile-image [src]="user.img" />
                  } @else {
                    <app-profile-image [src]="updateForm.value.img" />
                  }
                </label>
                <div class="min-w-0">
                  <div class="mt-4 truncate text-lg font-bold text-white sm:text-xl">
                    {{ user.username }}
                  </div>
                </div>
              </div>
            </div>
          </div>

          <div class="rounded-lg bg-[#2B2D31] p-4 sm:p-5">
            <div
              class="grid gap-3 border-b border-[#1E1F22] py-4 sm:grid-cols-[1fr_auto] sm:items-end"
            >
              <div class="min-w-0">
                <label for="username" class="text-xs font-bold text-gray-400 uppercase mb-1 block"
                  >Username</label
                >
                @if (!updateUsernameClicked) {
                  <div class="flex min-h-11 items-center px-2 text-white">
                    <span class="truncate">{{ activeUsername }}</span>
                  </div>
                } @else {
                  <input
                    type="text"
                    formControlName="username"
                    [defaultValue]="activeUsername"
                    class="w-full rounded bg-[#1E1F22] px-3 py-3 text-white outline-none font-medium min-h-11"
                  />
                }
              </div>

              <button
                type="button"
                (click)="updateUsernameClicked = !updateUsernameClicked"
                class="w-full rounded bg-[#4E5058] px-4 py-3 text-sm font-medium text-white transition-colors hover:bg-[#6D6F78] sm:w-auto sm:px-5"
              >
                {{ updateUsernameClicked ? 'Done' : 'Edit' }}
              </button>
            </div>

            <div class="grid gap-3 py-4 sm:grid-cols-[1fr_auto] sm:items-end">
              <div class="min-w-0">
                <label for="email" class="text-xs font-bold text-gray-400 uppercase mb-1 block"
                  >E-mail</label
                >
                @if (!updateEmailClicked) {
                  <div class="flex min-h-11 items-center px-2 text-white">
                    <span class="truncate">{{ activeEmail }}</span>
                  </div>
                } @else {
                  <input
                    type="text"
                    formControlName="email"
                    [defaultValue]="activeEmail"
                    class="w-full rounded bg-[#1E1F22] px-3 py-3 text-white outline-none font-medium min-h-11"
                  />
                }
              </div>
              <button
                type="button"
                (click)="updateEmailClicked = !updateEmailClicked"
                class="w-full rounded bg-[#4E5058] px-4 py-3 text-sm font-medium text-white transition-colors hover:bg-[#6D6F78] sm:w-auto sm:px-5"
              >
                {{ updateEmailClicked ? 'Done' : 'Edit' }}
              </button>
            </div>
          </div>

          <div class="mt-8 flex flex-col items-center">
            <button
              type="submit"
              [disabled]="!updateForm.dirty"
              class="w-full rounded bg-[#248046] px-6 py-3 font-medium text-white shadow-md transition-colors disabled:cursor-not-allowed disabled:opacity-50 hover:enabled:bg-[#1A6334] sm:w-auto"
            >
              Save Changes
            </button>
          </div>

          <div class="mt-10">
            <div class="mb-2 text-xs font-bold text-gray-400 uppercase">Danger zone</div>
            <div class="rounded-lg border border-red-500/20 bg-[#2B2D31] p-4 sm:p-5">
              <div class="flex flex-col gap-4 sm:flex-row sm:items-center sm:justify-between">
                <div class="min-w-0">
                  <div class="font-semibold text-white">Delete account</div>
                  <div class="mt-1 text-sm text-gray-400">
                    Permanently deletes your account and user data. This action cannot be undone.
                  </div>
                </div>

                <button
                  type="button"
                  (click)="openDeleteAccount()"
                  class="flex w-full items-center justify-center gap-2 rounded bg-red-600 px-4 py-3 text-sm font-semibold text-white shadow-sm transition-colors hover:bg-red-700 sm:w-auto"
                >
                  <lucide-icon [img]="Trash" class="w-4 h-4" />
                  Delete
                </button>
              </div>
            </div>
          </div>
        </form>
      </main>
    </div>
  </div>
</div>
